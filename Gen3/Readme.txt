Third generation of the open source editor for the G2 is an editor that can be used on a tablet.

The editor works like this: The editor contains an in memory database that mirrors the state of the G2. On connection with the G2 the state of the G2 is queried using a sequence of messages and the in memory database is initialized. After that all user interface actions are translated into messages and send to the G2. The G2 sends a response message, the in memory database is updated and the new state of the G2 is reflected in the user interface.

Setup of the source code

The application is build around interfaces, see unit BVE.NMG2FileIntf. The reason is that the Delphi mobile compilers use auto reference counting on all objects and interfaces. De Delphi windows compiler only on interfaces. So using interfaces, the same code base can be used on both the Windows and the mobile compilers.

The communication to the G2 is in the form of messages. The unit BVE.NMG2Com.pas is an abstraction of the communication layer. This unit also contains the undo-redo implementation based on the command design pattern. The unit BVE.NMG2ComUSB.pas contains the implementation of the communication layer specific for the USB protocol. The front end of the application uses the communication manager in BVE.NMG2ComManager.pas pass the user interface actions to the G2.

Changes in the G2 state are passed to the user interface using the observer pattern. So a user interface element, for example a knob, can register itself to a G2 back end part, for example a parameter. A change in the parameter will result in a notification call to registered user interface elements.

The user interface for the G2 is very complex. So to get the needed performance on a tablet, the GPU is used as much as possible. Therefore the user interface parts are build out of triangle meshes and textures just as in a video game. The textures can be generated by the "G2GenTex" application. The textures must then be zipped and included in the installation package. When the editor application starts, it unzips the textures to a "Cache" folder, which is used as a buffer. 
The unit BVE.NMG2ControlsGL.pas contains the low level implementation of the GPU controls. The unit BVE.NMG2Controls.pas derives user interface elements from of the GPU controls, basic buttons, radio buttons and so on. The unit BVE.NMG2ControlsG2.pas contains specific G2 user interface elements, modules, connectors, leds, buttons, knobs, etc.

Folder structure:

Bin: Output folder for the binaries
Common: Source code that is Delphi version independent, handling the back end part of the editor
UI: : Source code that is Delphi version independent, handling the user interface part of the editor
Img: Folder containing textures and images for the user interface
DX1: Source code containing Delphi version specific code, these are project files and form files
Patch: Folder containing test patches

Project files:

G2Editor.dproj : the editor
G2GenTex.dproj : texture generator

21-5-2017 Bruno Verhue



